# Omni-Adapter (Qwen)

Omni-Adapter的通义千问平台集成插件，用于自动化通义千问网站的交互，支持图像生成和图像编辑功能，通过MCP协议与后端服务通信。

## 功能特性

### 🎨 图像生成功能
- **文生图**: 根据文本提示词生成图像
- **图生图**: 基于参考图片进行图像编辑
- **智能比例**: 支持多种图像比例设置
- **自动上传**: 自动下载并上传参考图片

### 🔄 多Tab管理
- **智能tab检测**: 自动检测和管理所有打开的通义千问tab
- **轮询任务分发**: 使用轮询策略将任务分发到空闲的tab
- **任务队列**: 当所有tab都忙碌时，任务会被加入队列等待处理
- **状态监控**: 实时监控每个tab的状态（空闲/忙碌）

### 🌐 WebSocket连接
- **单一连接**: 无论开启多少个tab，只维护一个WebSocket连接
- **自动重连**: 连接断开时自动重连
- **消息路由**: 根据任务类型和tab状态智能路由消息

### 🖼️ 图片检测
- **实时监听**: 监听聊天容器中的图片生成
- **智能识别**: 自动识别通义千问生成的图片
- **单图保留**: 只保留最后生成的图片

### ⚙️ 设置管理
- **灵活配置**: 支持自动刷新、WebSocket地址等选项
- **实时监控**: 在设置页面查看所有tab的实时状态

## 安装方法

### 方法一：开发者模式安装（推荐）

1. 下载或克隆本项目
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择本项目的根目录

### 方法二：打包安装

1. 在项目根目录运行打包脚本
2. 将生成的 `.crx` 文件拖拽到 `chrome://extensions/` 页面

## 使用方法

### 1. 启动后端服务

确保MCP服务器正在运行，默认WebSocket地址为 `ws://localhost:8080`

### 2. 打开通义千问网站

访问 [https://chat.qwen.ai](https://chat.qwen.ai) 并登录

### 3. 使用扩展

- 扩展会自动检测并管理所有打开的通义千问tab
- 通过WebSocket接收MCP任务指令
- 自动执行图像生成或编辑任务
- 返回生成的图片URL

## 配置选项

在扩展设置页面可以配置：

- **WebSocket服务器地址**: 默认 `ws://localhost:8080`
- **自动刷新**: 任务完成后是否自动刷新页面

## 支持的功能

### 图像生成
- 支持多种图像比例：1:1, 2:3, 3:2, 16:9, 9:16, 4:3, 3:4
- 根据文本提示词生成图像
- 自动设置图像比例

### 图像编辑
- 支持参考图片上传
- 基于参考图片进行图像编辑
- 自动下载并上传参考图片

## 开发说明

### 项目结构

```
QwenMcpBrowserProxy/
├── manifest.json          # 扩展配置文件
├── background.js          # 后台脚本
├── content.js            # 内容脚本
├── settings-panel.js     # 设置面板
├── icons/                # 图标文件
├── LICENSE               # MIT许可证
├── .gitignore           # Git忽略文件
└── README.md            # 说明文档
```

### 主要文件说明

- **background.js**: 处理WebSocket连接、任务分发、tab管理
- **content.js**: 在通义千问页面中执行具体操作
- **settings-panel.js**: 提供用户设置界面

## 技术特点

- **智能DOM监听**: 监听聊天容器中的图片生成
- **自动功能切换**: 智能切换图像生成和编辑模式
- **文件上传优化**: 基于DataTransfer API的文件上传
- **错误处理**: 完善的错误处理和重试机制

## 注意事项

1. 本扩展仅用于学习和研究目的
2. 请遵守通义千问的使用条款
3. 不要用于商业用途
4. 使用时请保持合理的请求频率

## 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 贡献

欢迎提交Issue和Pull Request！

## 更新日志

### v1.0.0
- 初始版本发布
- 支持文生图和图生图功能
- 支持多tab管理
- 支持WebSocket通信
- 支持自动刷新设置
- 优化图片检测和上传逻辑